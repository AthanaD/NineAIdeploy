import{d as V,a5 as q,o,c as i,a as c,z as k,t as T,u as t,F as E,s as ne,f as a,_ as r,B as K,i as Q,v as f,w as I,q as ie,l as Y,I as J,Y as ce,m as X,k as Z,r as g,b as _,p as U,e as re,a3 as ue,ae as de,n as pe,Q as fe,y as P,K as O,be as ye,bf as ve,P as me}from"./index-c84c64f4.js";import{N as he}from"./Popconfirm-f57aa78c.js";import{N as H}from"./NumberAnimation-6da35ce7.js";import{N as _e}from"./LayoutSider-7fcfe0c7.js";function ke(L,$){let S;return(...b)=>{const u=()=>{clearTimeout(S),L(...b)};clearTimeout(S),S=setTimeout(u,$)}}const be={class:"mb-2 text-xs text-neutral-400 font-bold"},xe={class:"ml-1"},ge=["onClick"],Se={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap"},we={key:1},Ce={key:0,class:"absolute z-10 flex visible right-1"},Ie=["onClick"],$e={class:"p-1"},De={key:0,class:"p-1"},Te={class:"p-1"},R=V({__name:"ListItem",props:{dataSources:{},title:{}},emits:["update","delete","sticky","select"],setup(L,{emit:$}){const S=L,b=$,u=S.dataSources,d=q();async function B(n){b("select",n)}function y(n,s,p){p==null||p.stopPropagation(),n.isEdit=s}async function x(n,s){s==null||s.stopPropagation(),await d.updateGroupInfo({isSticky:!n.isSticky,groupId:n.uuid}),await d.queryMyGroup()}async function v(n,s){s==null||s.stopPropagation(),b("delete",n)}const m=ke(v,600);async function w(n){const{uuid:s,title:p}=n;n.isEdit=!1,await d.updateGroupInfo({groupId:s,title:p}),await d.queryMyGroup()}async function A(n,s){s==null||s.stopPropagation(),s.key==="Enter"&&w(n)}function N(n,s){s==null||s.stopPropagation(),w(n)}function G(n){return d.active===n}return(n,s)=>{var p;return o(),i(E,null,[c("p",be,[k(T(S.title)+" ",1),c("span",xe,"("+T((p=t(u))==null?void 0:p.length)+")",1)]),(o(!0),i(E,null,ne(t(u),l=>(o(),i("div",{key:`${l.uuid}`},[c("a",{class:ie(["relative flex items-center gap-3 px-3 py-2.5 break-all border rounded-md cursor-pointer hover:bg-neutral-100 group dark:border-neutral-800 dark:hover:bg-[#24272e]",G(l.uuid)&&["border-[#3076FD]","bg-neutral-100","text-[#3076FD]","dark:bg-[#24272e]","dark:border-[#3076fd]","pr-20"]]),onClick:e=>B(l)},[c("span",null,[a(t(r),{icon:l.isSticky?"ri:pushpin-2-line":l.appId?"icon-park-outline:application-one":"ri:message-3-line"},null,8,["icon"])]),c("div",Se,[l.isEdit?(o(),K(t(Q),{key:0,value:l.title,"onUpdate:value":e=>l.title=e,size:"tiny",onKeypress:e=>A(l,e)},null,8,["value","onUpdate:value","onKeypress"])):(o(),i("span",we,T(l.title),1))]),G(l.uuid)?(o(),i("div",Ce,[l.isEdit?(o(),i("button",{key:0,class:"p-1",onClick:e=>N(l,e)},[a(t(r),{icon:"ri:save-line"})],8,Ie)):(o(),i(E,{key:1},[c("button",$e,[a(t(r),{icon:l.isSticky?"ri:unpin-line":"ri:pushpin-line",onClick:e=>x(l,e)},null,8,["icon","onClick"])]),l.appId?f("",!0):(o(),i("button",De,[a(t(r),{icon:"ri:edit-line",onClick:e=>y(l,!0,e)},null,8,["onClick"])])),a(t(he),{placement:"bottom",onPositiveClick:e=>t(m)(l,e)},{trigger:I(()=>[c("button",Te,[a(t(r),{icon:"ri:delete-bin-line"})])]),default:I(()=>[k(" "+T(n.$t("chat.deleteHistoryConfirm")),1)]),_:2},1032,["onPositiveClick"])],64))])):f("",!0)],10,ge)]))),128))],64)}}}),Ge={class:"flex flex-col gap-3 text-sm"},Me={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},Ae=V({__name:"List",setup(L){const{isMobile:$}=Y(),S=J(),b=ce(),u=X(),d=q(),B=Z(),y=g(100),x=_(()=>d.groupList),v=_(()=>d.groupKeyWord);U(x,()=>y.value=y.value+1),U(v,()=>y.value=y.value+1),_(()=>B.isLogin);function m(e){const z=new Date(e).getTime()+8*60*60*1e3;return new Date(z).getTime()}const w=new Date().setHours(0,0,0,0),A=_(()=>x.value.filter(e=>v.value?e.title.includes(v.value)&&e.isSticky:e.isSticky)),N=_(()=>x.value.filter(e=>v.value?e.title.includes(v.value)&&!e.isSticky&&e.appId:!e.isSticky&&e.appId)),G=_(()=>x.value.filter(e=>v.value?e.title.includes(v.value)&&!e.isSticky&&!e.appId&&m(e.createdAt)>=w:!e.isSticky&&!e.appId&&m(e.createdAt)>=w)),n=_(()=>x.value.filter(e=>v.value?e.title.includes(v.value)&&!e.isSticky&&!e.appId&&m(e.createdAt)<w:!e.isSticky&&!e.appId&&m(e.createdAt)<w));async function s(e){const{uuid:M}=e;l(M)||(await d.setActiveGroup(M),b.name!=="Chat"&&S.push("/chat"),$.value&&u.setSiderCollapsed(!0))}async function p(e){event==null||event.stopPropagation(),await d.deleteGroup(e),await d.queryMyGroup(),$.value&&u.setSiderCollapsed(!0)}function l(e){return d.active===e}return re(()=>{d.queryMyGroup()}),(e,M)=>(o(),K(t(ue),{class:"px-4"},{default:I(()=>[c("div",Ge,[x.value.length?(o(),i(E,{key:1},[A.value.length?(o(),K(R,{key:1e3+y.value,title:"置顶","data-sources":A.value,onSelect:s,onDelete:p},null,8,["data-sources"])):f("",!0),N.value.length?(o(),K(R,{key:2e3+y.value,title:"应用分类组","data-sources":N.value,onSelect:s,onDelete:p},null,8,["data-sources"])):f("",!0),G.value.length?(o(),K(R,{key:3e3+y.value,title:"今天","data-sources":G.value,onSelect:s,onDelete:p},null,8,["data-sources"])):f("",!0),n.value.length?(o(),K(R,{key:4e3+y.value,title:"其他","data-sources":n.value,onSelect:s,onDelete:p},null,8,["data-sources"])):f("",!0)],64)):(o(),i("div",Me,[a(t(r),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),c("span",null,T(e.$t("common.noData")),1)]))])]),_:1}))}}),Ne={class:"flex flex-col h-full flex-1 min-h-0"},Be={key:0,class:"flex h-14 items-center space-x-2 bg-[#fafbfc] dark:bg-[#18181c]"},Pe={class:"flex-1"},Ke={key:1,class:"flex h-14 items-center space-x-2 px-2 bg-[#fafbfc] dark:bg-[#18181c]"},Le={class:"flex-1"},ze={class:"flex-1 min-h-0 pb-4 overflow-hidden"},Ue={key:2,class:"px-6 py-2 flex items-center border-t dark:border-t-neutral-800"},Re={class:"p-4 border-t dark:border-t-neutral-800 flex flex-col"},Ee={key:0,class:"my-1 flex items-center select-none"},Ve={key:1,class:"my-1 flex items-center select-none"},qe={key:2,class:"my-1 flex items-center select-none"},We={key:3,class:"my-1 flex items-center select-none"},Fe={key:4,class:"my-1 flex items-center select-none"},je={key:5,class:"my-1 flex items-center select-none"},Oe={class:"flex justify-between my-3"},He=c("span",{class:"mr-2"},"公告栏",-1),Qe=c("span",{class:"mr-3"},"工作台",-1),Ye={class:"flex justify-betweenx"},Je=c("span",{class:"mr-3"},"清空全部非置顶会话",-1),st=V({__name:"index",setup(L){const $=de(),S=J(),b=X(),u=q(),d=Z();pe();const B=g(null),y=g(null),x=_(()=>d.userBalance),v=fe(),m=_(()=>u==null?void 0:u.activeModelKeyDeductType),w=_(()=>u==null?void 0:u.activeModelKeyPrice),A=g(0),N=g(0),G=g(0),n=g(0),s=g(!1),p=g(null);U(()=>d.userBalance.useModel3Token,(h,C)=>{var D;A.value=C||0,N.value=h||0,(D=B.value)==null||D.play()},{immediate:!0,flush:"post"}),U(()=>d.userBalance.useModel4Token,(h,C)=>{var D;G.value=C||0,n.value=h||0,(D=y.value)==null||D.play()},{immediate:!0,flush:"post"});const{isMobile:l}=Y(),e=g(!1),M=_(()=>b.siderCollapsed),z=g("");function W(h){z.value=h,u.setGroupKeyWord(h)}function ee(){s.value=!1}function te(){S.push("/role")}async function F(){try{e.value=!0,await u.addNewChatGroup(),await u.queryMyGroup(),e.value=!1,l.value&&b.setSiderCollapsed(!0)}catch{e.value=!1}}async function se(){v.warning({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await u.delAllGroup()}})}function j(){b.setSiderCollapsed(!M.value)}function ae(){s.value=!0,me(()=>{var h;(h=p.value)==null||h.focus()})}const le=_(()=>l.value?{position:"fixed",zIndex:50}:{}),oe=_(()=>l.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{});return U(l,h=>{b.setSiderCollapsed(h)},{immediate:!0,flush:"post"}),(h,C)=>(o(),i("div",null,[a(t(_e),{collapsed:M.value,"collapsed-width":0,width:260,"show-trigger":t(l)?!1:"arrow-circle","collapse-mode":"transform",position:"absolute",bordered:"",style:O(le.value),onUpdateCollapsed:j},{default:I(()=>[c("div",{class:"flex flex-col h-full bg-[#fafbfc] dark:bg-[#18181c]",style:O(oe.value)},[c("main",Ne,[s.value?(o(),i("div",Be,[a(t(P),{type:"primary",loading:e.value,onClick:F},{default:I(()=>[a(t(r),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"]),c("div",Pe,[a(t(Q),{modelValue:z.value,"onUpdate:modelValue":C[0]||(C[0]=D=>z.value=D),ref_key:"searchRef",ref:p,type:"text",placeholder:"对话历史查找",onBlur:ee,clearable:"",onInput:W},null,8,["modelValue"])])])):f("",!0),s.value?f("",!0):(o(),i("div",Ke,[c("div",Le,[a(t(P),{type:"primary",style:{width:"100%"},loading:e.value,onClick:F},{default:I(()=>[k(" 新对话 "),a(t(r),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"])]),a(t(P),{onClick:ae},{default:I(()=>[a(t(r),{icon:"icon-park-outline:search",class:"text-xl"})]),_:1})])),c("div",ze,[a(Ae)]),t(l)?f("",!0):(o(),i("div",Ue,[c("div",{class:"flex items-center w-full p-1 mb-1 text-[#3076fd] rounded cursor-pointer transition hover:bg-[#eef0f3] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:C[1]||(C[1]=D=>t($).updateGoodsDialog(!0))},[a(t(r),{icon:"material-symbols:shopping-bag-outline",class:"mr-1 text-base"}),k(" 进入市场选购您的商品 ")])])),c("div",Re,[m.value===1?(o(),i("div",Ee,[a(t(r),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),k("普通额度： "+T(`${x.value.sumModel3Count||0} 积分`),1)])):f("",!0),m.value===1?(o(),i("div",Ve,[a(t(r),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),k(" 我已使用： "),a(t(H),{ref_key:"model3AnimationInstRef",ref:B,from:A.value,to:N.value},null,8,["from","to"]),k(" Token ")])):f("",!0),m.value===1?(o(),i("div",qe,[a(t(r),{icon:"mingcute:bill-line",class:"ml-2 mr-2 text-base"}),k(" 模型费用： "+T(`${w.value||0}积分 / 次对话`),1)])):f("",!0),m.value===2?(o(),i("div",We,[a(t(r),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),k("我已使用： "),a(t(H),{ref_key:"model4AnimationInstRef",ref:y,from:G.value,to:n.value},null,8,["from","to"]),k(" Token ")])):f("",!0),m.value===2?(o(),i("div",Fe,[a(t(r),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),k("高级额度： "+T(`${x.value.sumModel4Count||0} 积分`),1)])):f("",!0),m.value===2?(o(),i("div",je,[a(t(r),{icon:"mingcute:bill-line",class:"ml-2 mr-2 text-base"}),k("模型费用： "+T(`${w.value||0}积分 / 次对话`),1)])):f("",!0),c("div",Oe,[a(t(P),{type:"tertiary",size:"small",onClick:C[2]||(C[2]=D=>t($).updateNoticeDialog(!0))},{default:I(()=>[a(t(r),{icon:"mdi:notice-board",class:"ml-2 mr-2 text-sm"}),He]),_:1}),a(t(P),{type:"tertiary",size:"small",onClick:te},{default:I(()=>[a(t(r),{icon:"ri:emoji-sticker-line",class:"ml-2 mr-2 text-sm"}),Qe]),_:1})]),c("div",Ye,[a(t(P),{type:"tertiary",size:"small",style:{width:"100%"},onClick:se},{default:I(()=>[a(t(r),{icon:"ant-design:delete-outlined",class:"ml-2 mr-2 text-sm"}),Je]),_:1})])])])],4)]),_:1},8,["collapsed","show-trigger","style"]),t(l)?ye((o(),i("div",{key:0,class:"fixed inset-0 z-40 bg-black/40",onClick:j},null,512)),[[ve,!M.value]]):f("",!0)]))}});export{st as _};
