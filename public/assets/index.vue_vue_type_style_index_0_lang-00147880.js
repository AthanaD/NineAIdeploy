import{d as ne,k as re,H as ae,n as ie,r as l,b as L,I as le,p as O,e as ce,J as ue,c as g,a as s,K as m,F as de,s as pe,o as c,f as _,w as u,T as he,t as fe,B as $,M as P,u as h,_ as B,O as M,v as w,P as ve}from"./index-c84c64f4.js";import{c as ge}from"./index-c94da121.js";function me(x,y){let d,n;return function(...k){n=k,d||(d=setTimeout(()=>{x.apply(this,n),d=null},y))}}const _e={class:"min-h-full overflow-hidden flex flex-col"},we={class:"flex-1 min-h-full p-4 relative"},xe=["id"],ye=["id","src","onLoad","onError","onClick"],be={class:"menu p-2 text-[#cbd5e1]"},ke={class:"prompt"},Ce={class:"flex justify-end items-end space-x-2"},Ie=["onClick"],Le={class:"text-sm dark:text-slate-400"},$e=s("span",null,"画同款",-1),Pe=["onClick"],Be={class:"text-sm dark:text-slate-400"},Me=s("span",null,"使用当前画同款",-1),Ee=["onClick"],We={class:"text-sm dark:text-slate-400"},De=s("span",null,"复制提示词",-1),He=s("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1),Re=ne({__name:"index",props:{dataList:{},scaleWidth:{},isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5},preOrigin:{type:Boolean}},emits:["loadMore","usePropmptDraw"],setup(x,{emit:y}){var N;const d=re(),n=x,b=y,k=(N=ae())==null?void 0:N.appContext.config.globalProperties.$viewerApi,S=ie(),E=l({}),W=l(0),a=l(160),p=l(0),C=l([]),I=l(null),D=l(0),A=L(()=>d.isLogin),H=L(()=>n.scaleWidth?Number(n.scaleWidth)*2+n.gap+150:150),U=le();function V(){J(),K();const e=p.value,o=a.value,t=[];n.dataList.forEach((i,r)=>{const{width:ee,height:te}=i.fileInfo,oe=o/ee,R=te*oe+n.gap+W.value,v=E.value[i.id];if(t.length<e)v.style.top="0px",v.style.left=`${(o+n.gap)*r}px`,t.push(R);else{const T=Math.min.apply(null,t),z=t.findIndex(se=>se===T);v.style.top=`${T+0}px`,v.style.left=`${z*(a.value+n.gap)}px`,t[z]+=R}}),D.value=Math.max(...t)+100}function F(e,o){e&&o&&(E.value[o.id]=e)}function J(){const{showName:e=0,showOther:o=0}={};W.value=[e,o].filter(t=>t).length*15}O(()=>n.scaleWidth,e=>{f()}),O(()=>n.dataList,e=>{e&&ve(()=>{f()})},{immediate:!0});function K(){if(!I.value)return;const e=I.value.clientWidth;p.value=Math.floor(e/H.value);const o=e-p.value*H.value,t=(p.value-1)*n.gap;o-t<0&&(p.value-=1),a.value=Math.floor((e-t)/p.value)}function q(e,o){C.value.push(o.id)}function G(e,o){C.value.push(o.id)}function Q(e){if(!A.value)return d.setLoginDialog(!0);const{prompt:o}=e;ge({text:o}),S.success("复制prompt成功")}function X(e){U.push(`/midjourney?mjId=${e.id}`)}function Y(e){const{prompt:o}=e;b("usePropmptDraw",o)}function Z(e){const{fileInfo:o}=e,{cosUrl:t}=o;k({options:{},images:[t]})}const j=L(()=>e=>{const{fileInfo:o}=e,{width:t,height:i}=o;return i/(t/a.value)}),f=me(function(){V()},200);return ce(async()=>{window.addEventListener("resize",f);const e=document.getElementById("footer");new IntersectionObserver((t,i)=>{t.forEach(r=>{r.isIntersecting&&b("loadMore")})}).observe(e)}),ue(()=>{window.removeEventListener("resize",f)}),(e,o)=>(c(),g("div",_e,[s("div",we,[s("div",{id:"wapper",ref_key:"wapperRef",ref:I,class:"wapper",style:m({height:`${D.value}px`})},[(c(!0),g(de,null,pe(e.dataList,(t,i)=>(c(),g("div",{id:t.id,key:i,ref_for:!0,ref:r=>F(r,t),class:"wapper-item",style:m({width:`${a.value}px`})},[_(he,{name:"img",css:!0},{default:u(()=>[s("img",{id:t.id,class:"item-file rounded-sm",style:m({width:`${a.value}px`,height:`${j.value(t)}px`}),src:e.preOrigin?t.fileInfo.cosUrl:t.fileInfo.thumbImg,loading:"lazy",onLoad:r=>q(r,t),onError:r=>G(r,t),onClick:r=>Z(t)},null,44,ye)]),_:2},1024),s("div",be,[s("div",ke,fe(t.fullPrompt),1),s("div",Ce,[e.isDrawLike?(c(),$(h(M),{key:0,trigger:"hover"},{trigger:u(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(r=>X(t),["stop"])},[s("span",Le,[_(h(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Ie)]),default:u(()=>[$e]),_:2},1024)):w("",!0),e.usePropmpt?(c(),$(h(M),{key:1,trigger:"hover"},{trigger:u(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(r=>Y(t),["stop"])},[s("span",Be,[_(h(B),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Pe)]),default:u(()=>[Me]),_:2},1024)):w("",!0),e.copyPropmpt?(c(),$(h(M),{key:2,trigger:"hover"},{trigger:u(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:P(r=>Q(t),["stop"])},[s("span",We,[_(h(B),{icon:"tabler:copy",class:"text-sm"})])],8,Ee)]),default:u(()=>[De]),_:2},1024)):w("",!0)])]),C.value.includes(t.id)?w("",!0):(c(),g("div",{key:0,class:"item-loading",style:m({width:`${a.value}px`,height:`${j.value(t)}px`})},null,4))],12,xe))),128)),He],4)])]))}});export{Re as _};
